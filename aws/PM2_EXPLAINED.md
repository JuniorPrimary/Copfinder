# Понимание вывода PM2 status

## Расшифровка колонок

```
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 1  │ copfinder-copart   │ cluster  │ 2    │ online    │ 0%       │ 103.2mb  │
│ 0  │ copfinder-iaai     │ cluster  │ 2    │ online    │ 0%       │ 334.9mb  │
```

### Колонки:

- **id** — уникальный идентификатор процесса в PM2
- **name** — имя процесса из `ecosystem.config.cjs`
- **mode** — режим работы:
  - `cluster` — стандартный режим (не означает несколько инстансов!)
  - `fork` — отдельный процесс
- **↺ (restarts)** — количество перезапусков процесса
  - `0` — никогда не перезапускался
  - `2` — был перезапущен 2 раза
  - Это нормально, если приложение падало или вы его перезапускали вручную
- **status** — текущий статус:
  - `online` — работает нормально ✅
  - `stopped` — остановлен
  - `errored` — ошибка
  - `restarting` — перезапускается
- **cpu** — использование CPU в процентах
- **memory** — использование памяти

---

## Что означает "↺ 2" (2 перезапуска)?

### Возможные причины:

1. **Ручной перезапуск** — вы запускали `pm2 restart`
2. **Автоматический перезапуск при ошибке** — приложение упало, PM2 его перезапустил
3. **Обновление кода** — при развертывании приложение перезапускалось
4. **Перезагрузка сервера** — если сервер перезагружался

### Это нормально?

✅ **Да, это нормально!** PM2 специально перезапускает процессы при ошибках, чтобы приложение продолжало работать.

⚠️ **Обратите внимание, если:**
- Количество перезапусков постоянно растет (например, каждую минуту)
- Статус `errored` или `restarting`
- Приложение не работает

---

## Как проверить, почему были перезапуски?

### 1. Просмотр логов

```bash
# Все логи
pm2 logs

# Логи конкретного процесса
pm2 logs copfinder-copart
pm2 logs copfinder-iaai

# Последние 50 строк
pm2 logs --lines 50

# Логи с временными метками
pm2 logs --timestamp
```

### 2. Просмотр информации о процессе

```bash
# Детальная информация
pm2 show copfinder-copart
pm2 show copfinder-iaai

# История перезапусков
pm2 describe copfinder-copart
```

### 3. Мониторинг в реальном времени

```bash
# Мониторинг всех процессов
pm2 monit

# Или через веб-интерфейс (если настроен)
pm2 web
```

---

## Что делать, если перезапусков слишком много?

### Шаг 1: Проверьте логи на ошибки

```bash
pm2 logs --err --lines 100
```

### Шаг 2: Проверьте использование ресурсов

```bash
pm2 monit
```

Если память или CPU на максимуме — возможно, нужно увеличить размер инстанса.

### Шаг 3: Проверьте конфигурацию

```bash
# На сервере
cd /opt/copfinder
cat ecosystem.config.cjs
```

Убедитесь, что `max_memory_restart` установлен правильно (например, `1G`).

### Шаг 4: Перезапустите вручную и следите

```bash
pm2 restart ecosystem.config.cjs
pm2 logs --lines 0  # Следите за новыми логами
```

---

## Нормальные значения

### ✅ Хорошо:
- **↺ 0-5** — нормально, особенно после развертывания
- **status: online** — приложение работает
- **cpu: 0-10%** — нормальная нагрузка (когда не активен)
- **memory: 100-500mb** — нормально для Node.js приложения

### ⚠️ Требует внимания:
- **↺ постоянно растет** — приложение падает
- **status: errored** — есть ошибки
- **cpu: >50% постоянно** — высокая нагрузка
- **memory: >1GB** — возможно, утечка памяти

---

## Полезные команды

```bash
# Сброс счетчика перезапусков (после исправления проблемы)
pm2 reset all

# Перезапуск без увеличения счетчика
pm2 reload ecosystem.config.cjs  # Graceful reload

# Остановка и очистка
pm2 stop ecosystem.config.cjs
pm2 delete ecosystem.config.cjs
pm2 start ecosystem.config.cjs
```

---

## Примеры статусов

### Нормальная работа:
```
│ 1  │ copfinder-copart   │ cluster  │ 0    │ online    │ 0%       │ 103.2mb  │
```
✅ Никогда не перезапускался, работает нормально

### После обновления:
```
│ 1  │ copfinder-copart   │ cluster  │ 2    │ online    │ 0%       │ 103.2mb  │
```
✅ Нормально, перезапускался при обновлении

### Проблема:
```
│ 1  │ copfinder-copart   │ cluster  │ 15   │ restarting│ 0%       │ 103.2mb  │
```
⚠️ Много перезапусков, приложение не может запуститься

### Ошибка:
```
│ 1  │ copfinder-copart   │ cluster  │ 3    │ errored   │ 0%       │ 103.2mb  │
```
❌ Приложение упало с ошибкой

---

## В вашем случае

```
│ 1  │ copfinder-copart   │ cluster  │ 2    │ online    │ 0%       │ 103.2mb  │
│ 0  │ copfinder-iaai     │ cluster  │ 2    │ online    │ 0%       │ 334.9mb  │
```

**Это нормально!** ✅
- Оба процесса работают (`online`)
- По 2 перезапуска — вероятно, при развертывании или после настройки
- Низкое использование CPU — приложение не активно (ждет cron-задач)
- Нормальное использование памяти

**Что проверить:**
```bash
# Проверьте логи на наличие ошибок
pm2 logs --lines 50

# Если все хорошо, можно сбросить счетчик
pm2 reset all
```










