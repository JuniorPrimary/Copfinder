# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –≤–Ω–µ—Å–µ–Ω–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –ø—Ä–æ–µ–∫—Ç –∏ –∏—Ö —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –Ω–∞ EC2 —Å–µ—Ä–≤–µ—Ä–µ.

---

## üöÄ –ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –ù–∞ –≤–∞—à–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–º Mac
cd /Users/ff/Desktop/Copfinder

# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
export AWS_PUBLIC_IP="54.235.6.145"  # –í–∞—à IP
export AWS_SSH_KEY="~/.ssh/copfinder-key.pem"
export AWS_SSH_USER="ec2-user"

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
./aws/ec2-deploy.sh
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- ‚úÖ –°–æ–∑–¥–∞—Å—Ç –∞—Ä—Ö–∏–≤ —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
- ‚úÖ –ó–∞–≥—Ä—É–∑–∏—Ç –µ–≥–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- ‚úÖ –†–∞—Å–ø–∞–∫—É–µ—Ç –≤ `/opt/copfinder`
- ‚úÖ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ PM2

---

## üìù –ü–æ—à–∞–≥–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

### –®–∞–≥ 1: –í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω–æ

–í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥ –Ω–∞ –≤–∞—à–µ–º Mac –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `/Users/ff/Desktop/Copfinder`

### –®–∞–≥ 2: –°–æ–∑–¥–∞–π—Ç–µ –∞—Ä—Ö–∏–≤ –∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä

```bash
cd /Users/ff/Desktop/Copfinder

# –°–æ–∑–¥–∞–π—Ç–µ –∞—Ä—Ö–∏–≤ (–∏—Å–∫–ª—é—á–∞—è –Ω–µ–Ω—É–∂–Ω—ã–µ —Ñ–∞–π–ª—ã)
COPYFILE_DISABLE=1 tar --exclude='node_modules' \
    --exclude='.git' \
    --exclude='logs' \
    --exclude='.pm2' \
    --exclude='artifacts' \
    --exclude='.DS_Store' \
    -czf /tmp/copfinder-update.tar.gz .

# –ó–∞–≥—Ä—É–∑–∏—Ç–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
scp -i ~/.ssh/copfinder-key.pem /tmp/copfinder-update.tar.gz ec2-user@54.235.6.145:/tmp/
```

### –®–∞–≥ 3: –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–¥ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh -i ~/.ssh/copfinder-key.pem ec2-user@54.235.6.145

# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
cd /opt/copfinder

# –°–æ–∑–¥–∞–π—Ç–µ –±—ç–∫–∞–ø —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
cp -r . ../copfinder-backup-$(date +%Y%m%d-%H%M%S)

# –†–∞—Å–ø–∞–∫—É–π—Ç–µ –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é
tar -xzf /tmp/copfinder-update.tar.gz

# –£–¥–∞–ª–∏—Ç–µ –∞—Ä—Ö–∏–≤
rm /tmp/copfinder-update.tar.gz

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª—Å—è package.json)
npm ci --only=production

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
pm2 restart ecosystem.config.cjs
pm2 save
```

---

## üîÑ –¢–∏–ø—ã –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ —á—Ç–æ –¥–µ–ª–∞—Ç—å

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ (JavaScript —Ñ–∞–π–ª—ã)

```bash
# –ü—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
pm2 restart ecosystem.config.cjs
```

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ package.json (–Ω–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:
cd /opt/copfinder
npm ci --only=production
pm2 restart ecosystem.config.cjs
```

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–Ω—Ñ–∏–≥–∞—Ö (config/*.json)

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:
cd /opt/copfinder
pm2 restart ecosystem.config.cjs
```

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ .env —Ñ–∞–π–ª–µ

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
cd /opt/copfinder
nano .env  # –í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
pm2 restart ecosystem.config.cjs
```

**–í–∞–∂–Ω–æ:** `.env` —Ñ–∞–π–ª –ù–ï –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–∏ (–æ–Ω –≤ .gitignore), –ø–æ—ç—Ç–æ–º—É –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω—É–∂–Ω–æ –≤–Ω–æ—Å–∏—Ç—å –≤—Ä—É—á–Ω—É—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

---

## üõ†Ô∏è –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### –ü–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
cd /opt/copfinder
npm ci --only=production
npx playwright install chromium  # –ï—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª—Å—è Playwright
pm2 restart ecosystem.config.cjs
pm2 save
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –∫–æ–¥–∞ (–±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
cd /opt/copfinder
pm2 restart ecosystem.config.cjs
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
cd /opt/copfinder
pm2 logs --lines 50  # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–µ–∫—É—â–∏–µ –ª–æ–≥–∏
pm2 restart ecosystem.config.cjs
pm2 logs --lines 50  # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
```

---

## üì¶ –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `update.sh` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```bash
#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

set -e

PUBLIC_IP="${AWS_PUBLIC_IP:-54.235.6.145}"
SSH_KEY="${AWS_SSH_KEY:-~/.ssh/copfinder-key.pem}"
SSH_USER="${AWS_SSH_USER:-ec2-user}"
APP_DIR="/opt/copfinder"

echo "üöÄ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Copfinder –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ..."

# –°–æ–∑–¥–∞–µ–º –∞—Ä—Ö–∏–≤
echo "üì¶ –°–æ–∑–¥–∞–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞..."
COPYFILE_DISABLE=1 tar --exclude='node_modules' \
    --exclude='.git' \
    --exclude='logs' \
    --exclude='.pm2' \
    --exclude='artifacts' \
    --exclude='.DS_Store' \
    -czf /tmp/copfinder-update.tar.gz .

# –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
echo "üì§ –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä..."
scp -i "$SSH_KEY" /tmp/copfinder-update.tar.gz "$SSH_USER@$PUBLIC_IP:/tmp/"

# –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
echo "üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ..."
ssh -i "$SSH_KEY" "$SSH_USER@$PUBLIC_IP" << EOF
    set -e
    cd $APP_DIR
    
    # –†–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ–º
    tar -xzf /tmp/copfinder-update.tar.gz
    rm /tmp/copfinder-update.tar.gz
    
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
    if [ -f package.json ]; then
        npm ci --only=production
    fi
    
    # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º
    pm2 restart ecosystem.config.cjs
    pm2 save
    
    echo "‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
EOF

echo "‚úÖ –ì–æ—Ç–æ–≤–æ! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: ssh -i $SSH_KEY $SSH_USER@$PUBLIC_IP 'cd $APP_DIR && pm2 logs'"
```

–°–¥–µ–ª–∞–π—Ç–µ –µ–≥–æ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º:

```bash
chmod +x update.sh
```

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

```bash
./update.sh
```

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh -i ~/.ssh/copfinder-key.pem ec2-user@54.235.6.145

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
pm2 status

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
pm2 logs --lines 50

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å
pm2 logs copfinder-copart --lines 20
pm2 logs copfinder-iaai --lines 20
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–§–∞–π–ª .env –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**
   - –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `.env` –Ω—É–∂–Ω–æ –≤–Ω–æ—Å–∏—Ç—å –≤—Ä—É—á–Ω—É—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
   - –§–∞–π–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `/opt/copfinder/.env`

2. **–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è**
   - –§–∞–π–ª—ã –≤ `data/` (copart-seen.json, sent-lots.json) —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏
   - –õ–æ–≥–∏ –≤ `logs/` —Ç–∞–∫–∂–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

3. **PM2 —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ**
   - –ü–æ—Å–ª–µ `pm2 save` –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å–µ—Ä–≤–µ—Ä–∞

4. **–ë—ç–∫–∞–ø—ã (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**
   - –ü–µ—Ä–µ–¥ –±–æ–ª—å—à–∏–º–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –±—ç–∫–∞–ø:
   ```bash
   ssh -i ~/.ssh/copfinder-key.pem ec2-user@54.235.6.145
   cd /opt
   sudo tar -czf copfinder-backup-$(date +%Y%m%d).tar.gz copfinder/
   ```

---

## üêõ –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
cd /opt/copfinder

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏–∑ –±—ç–∫–∞–ø–∞
cd /opt
sudo tar -xzf copfinder-backup-YYYYMMDD.tar.gz

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ git (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
git checkout HEAD~1

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ
pm2 restart ecosystem.config.cjs
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [PM2 Documentation](https://pm2.keymetrics.io/)
- [–û—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è](EC2_SETUP.md)

